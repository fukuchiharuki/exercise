# Day 3. AWSにおけるネットワーク(2)

### セキュリティグループ

EC2にアタッチするセキュリティ設定。

セキュリティグループを指定するセキュリティグループを作成することができる。たとえば、「`DB-security-group`は`Web-security-group`がつくEC2からのアクセスを許す」など。

### ネットワーク ACL

サブネットにアタッチするセキュリティ設定。

ステートレスな設定なので、入る側を許可できていても出る側を許可できていなければ通信できない。注意する。

### ルートテーブル

サブネットにアタッチするルーティング設定。

サブネットがプライベート用途で、デフォルトのルートテーブルが期待するルートテーブルであっても、明示的にルートテーブルを作成するのがよい。

### NAT ゲートウェイ

アドレス変換機構。

プライベートなサブネットからインターネットに接続したい場合、パブリックなサブネットに置くNAT ゲートウェイを経由する。

## 構築

### セキュリティグループの変更

セキュリティグループの変更はEC2を選択して、

```
アクション > ネットワーキング > セキュリティグループの変更
```

### EC2の初期設定（ユーザーデータ）

```
#!/bin/bash

# ホスト名
sed -i 's/^HOSTNAME=[a-zA-Z0-9\.\-]*$/HOSTNAME=sample-vpc-db-1a/g' /etc/sysconfig/network
hostname 'sample-vpc-db-1a'

# タイムゾーン
cp /usr/share/zoneinfo/Japan /etc/localtime
sed -i 's|^ZONE=[a-zA-Z0-9\.\-\"]*$|ZONE="Asia/Tokyo”|g' /etc/sysconfig/clock

# 言語設定
echo "LANG=ja_JP.UTF-8" > /etc/sysconfig/i18n
```

### NAT ゲートウェイを経由する

プライベートサブネットにアタッチしたルートテーブルにNAT ゲートウェイを追加する。

```
Destination: 0.0.0.0/0
Target: nat-***** (作成したNAT ゲートウェイ)
```